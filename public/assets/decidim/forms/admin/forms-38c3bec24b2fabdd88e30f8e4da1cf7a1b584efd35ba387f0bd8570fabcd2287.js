"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=function(){function e(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.listSelector=t.listSelector,this.minItems=t.minItems,this.hideOnMinItemsOrLessSelector=t.hideOnMinItemsOrLessSelector,this.run()}return _createClass(e,[{key:"run",value:function(){var e=$(this.listSelector),t=e.find(this.hideOnMinItemsOrLessSelector);e.length<=this.minItems?t.hide():t.show()}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.AutoButtonsByMinItemsComponent=t}(window);_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=function(){function e(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperSelector=t.wrapperSelector,this.selectSelector=t.selectSelector,this.listSelector=t.listSelector}return _createClass(e,[{key:"run",value:function(){var e=$(this.listSelector),t=e.parents(this.wrapperSelector).find(this.selectSelector);t.find("option").slice(1).remove();for(var n=2;n<=e.length;n+=1)$('<option value="'+n+'">'+n+"</option>").appendTo(t)}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.AutoSelectOptionsByTotalItemsComponent=t}(window);_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=function(){function e(){var t=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.inputSelector=t.inputSelector,this.targetSelector=t.targetSelector,this.maxLength=t.maxLength,this.omission=t.omission,this.placeholder=t.placeholder,this._bindEvent(),this._run()}return _createClass(e,[{key:"_run",value:function(){var e=$(this.inputSelector),t=$(this.targetSelector),n=e.val()||this.placeholder;n.length>this.maxLength&&(n=n.substring(0,this.maxLength-this.omission.length)+this.omission),t.text(n)}},{key:"_bindEvent",value:function(){$(this.inputSelector).on("change",this._run.bind(this))}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.LiveTextUpdateComponent=t,e.DecidimAdmin.createLiveTextUpdateComponent=function(e){return new t(e)}}(window),function(e){var t=e.DecidimAdmin,n=t.AutoLabelByPositionComponent,i=t.AutoButtonsByPositionComponent,o=t.AutoButtonsByMinItemsComponent,r=t.AutoSelectOptionsByTotalItemsComponent,l=t.createLiveTextUpdateComponent,a=t.createFieldDependentInputs,s=t.createDynamicFields,c=t.createSortList,u=e.Decidim.createQuillEditor,d=".questionnaire-questions",p=".questionnaire-question",m="select[name$=\\[question_type\\]]",f=".questionnaire-question-answer-option",h=".questionnaire-question-answer-options",S=".remove-answer-option",v=".questionnaire-question-matrix-row",w=".questionnaire-question-matrix-rows",q=".remove-matrix-row",g=".add-matrix-row",C=".questionnaire-question-max-choices",_=["single_option","multiple_option","sorting","matrix_single","matrix_multiple"],b=["matrix_single","matrix_multiple"],F=new n({listSelector:".questionnaire-question:not(.hidden)",labelSelector:".card-title span:first",onPositionComputed:function(e,t){$(e).find("input[name$=\\[position\\]]").val(t)}}),y=new i({listSelector:".questionnaire-question:not(.hidden)",hideOnFirstSelector:".move-up-question",hideOnLastSelector:".move-down-question"}),x=function(e){return new r({wrapperSelector:p,selectSelector:C+" select",listSelector:"#"+e+" "+h+" .questionnaire-question-answer-option:not(.hidden)"})},A=function(e){return new o({wrapperSelector:p,listSelector:"#"+e+" "+h+" .questionnaire-question-answer-option:not(.hidden)",minItems:2,hideOnMinItemsOrLessSelector:S})},I=function(){c(".questionnaire-questions-list:not(.published)",{handle:".question-divider",placeholder:'<div style="border-style: dashed; border-color: #000"></div>',forcePlaceholderSize:!0,onSortUpdate:function(){F.run(),y.run()}})},B=function(e){var t="#"+e+" .question-title-statement",n=$(t).data("locale"),i=$(t).data("max-length"),o=$(t).data("omission"),r=$(t).data("placeholder");return l({inputSelector:"#"+e+" input[name$=\\[body_"+n+"\\]]",targetSelector:t,maxLength:i,omission:o,placeholder:r})},O=function(e){var t=A(e),n=x(e);return s({placeholderId:"questionnaire-question-answer-option-id",wrapperSelector:"#"+e+" "+h,containerSelector:".questionnaire-question-answer-options-list",fieldSelector:f,addFieldButtonSelector:".add-answer-option",fieldTemplateSelector:".decidim-answer-option-template",removeFieldButtonSelector:S,onAddField:function(){t.run(),n.run()},onRemoveField:function(){t.run(),n.run()}})},D={},L=function(e){return s({placeholderId:"questionnaire-question-matrix-row-id",wrapperSelector:"#"+e+" "+w,containerSelector:".questionnaire-question-matrix-rows-list",fieldSelector:v,addFieldButtonSelector:g,fieldTemplateSelector:".decidim-matrix-row-template",removeFieldButtonSelector:q,onAddField:function(){},onRemoveField:function(){}})},k={},T=function(e){var t=e.val();return _.indexOf(t)>=0},M=function(e){var t=e.val();return b.indexOf(t)>=0},P=function(e){var t=e.attr("id"),n=e.find(m);B(t),a({controllerField:n,wrapperSelector:p,dependentFieldsSelector:h,dependentInputSelector:f+" input",enablingCondition:function(e){return T(e)}}),a({controllerField:n,wrapperSelector:p,dependentFieldsSelector:C,dependentInputSelector:"select",enablingCondition:function(e){return"multiple_option"===e.val()||"matrix_multiple"===e.val()}}),a({controllerField:n,wrapperSelector:p,dependentFieldsSelector:w,dependentInputSelector:v+" input",enablingCondition:function(e){return M(e)}}),D[t]=O(t),k[t]=L(t);var i=D[t],o=k[t],r=function(){T(n)&&(0===n.parents(p).find(f).length&&(i._addField(),i._addField()));M(n)&&(0===n.parents(p).find(v).length&&(o._addField(),o._addField()))};n.on("change",r),r()},E=function(e){"true"===e.find("input[name$=\\[deleted\\]]").val()&&(e.addClass("hidden"),e.hide())};s({placeholderId:"questionnaire-question-id",wrapperSelector:d,containerSelector:".questionnaire-questions-list",fieldSelector:p,addFieldButtonSelector:".add-question",addSeparatorButtonSelector:".add-separator",fieldTemplateSelector:".decidim-question-template",separatorTemplateSelector:".decidim-separator-template",removeFieldButtonSelector:".remove-question",moveUpFieldButtonSelector:".move-up-question",moveDownFieldButtonSelector:".move-down-question",onAddField:function(e){var t=e.find(".collapsible");if(t.length>0){var n=t.attr("id").replace("-question-card",""),i=n+"-question-card button--collapse-question-"+n+" button--expand-question-"+n;e.find(".question--collapse").data("toggle",i)}P(e),I(),e.find(".editor-container").each(function(e,t){u(t)}),F.run(),y.run()},onRemoveField:function(e){F.run(),y.run(),e.find(S).each(function(t,n){D[e.attr("id")]._removeField(n)}),e.find(q).each(function(t,n){k[e.attr("id")]._removeField(n)})},onMoveUpField:function(){F.run(),y.run()},onMoveDownField:function(){F.run(),y.run()}}),I(),$(p).each(function(e,t){var n=$(t);E(n),P(n)}),F.run(),y.run()}(window);